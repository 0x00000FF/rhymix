function initTemplete(e){switch(e){case"poll":if("undefined"==typeof window.template){var l=jQuery("#entry-template").html();window.template=Handlebars.compile(l)}break;case"result":if("undefined"==typeof window.template_result){var l=jQuery("#entry-template-result").html();window.template_result=Handlebars.compile(l)}break;case"members":if("undefined"==typeof window.template_member){var l=jQuery("#entry-template-members").html();window.template_member=Handlebars.compile(l)}}}function doPoll(e){for(var l=new Array,t=new Array,o=0;o<e.length;o++){var s=e[o];if("INPUT"==s.nodeName){var r=s.name;if(r.indexOf("checkcount")>-1){var n=r.split("_"),i=parseInt(n[1],10);l[i]=s.value,t[i]=new Array}else if(r.indexOf("item_")>-1){var n=r.split("_"),u=parseInt(n[1],10),i=parseInt(n[2],10);1==s.checked&&(t[i][t[i].length]=s.value)}}}var _="";for(var i in l)if(l.hasOwnProperty(i)){var a=l[i],p=t[i];if(p.length<1||a<p.length)return alert(poll_alert_lang),!1;_+=p.join(",")+","}return e.poll_srl_indexes.value=_,jQuery.exec_json("poll.procPoll",{poll_srl:u,poll_srl_indexes:_},function(e){0!=e.error?alert(e.message):(loadPollResult(u),jQuery("#poll_"+u+"_gotoresult_button").css({display:"none"}),jQuery("#poll_"+u+"_result_nobutton").css({display:"table-row"}),jQuery("#poll_"+u+"_result_yesbutton").css({display:"none"}))}),!1}function addItem(e,l){return jQuery.exec_json("poll.procPollInsertItem",{srl:e,index_srl:l,title:jQuery("#new_item_"+l).val()},function(l){0!=l.error?alert(l.message):(jQuery("#poll_"+e+"_result_button").css({display:"none"}),jQuery("#poll_"+e+"_result_nobutton").css({display:"table-row"}),jQuery("#poll_"+e+"_result_yesbutton").css({display:"none"}),loadPoll(e))}),!1}function deleteItem(e,l,t){return jQuery.exec_json("poll.procPollDeleteItem",{srl:e,index_srl:l,item_srl:t},function(l){0!=l.error?alert(l.message):(jQuery("#poll_"+e+"_result_button").css({display:"none"}),jQuery("#poll_"+e+"_result_nobutton").css({display:"table-row"}),jQuery("#poll_"+e+"_result_yesbutton").css({display:"none"}),loadPoll(e))}),!1}function loadPoll(e){jQuery.exec_json("poll.getPollinfo",{poll_srl:e},function(l){jQuery("#stop_date_"+e).html(l.poll.stop_date),initTemplete("poll");var t=window.template,o=Object,s=l.caniadditem;o.questions={};for(var r in l.poll.poll){var n=l.poll.poll[r];o.questions[r]={},o.questions[r].poll_index_srl=n.poll_index_srl,o.questions[r].checkcount=n.checkcount,o.questions[r].title=n.title,o.questions[r].items=n.item,o.questions[r].poll_srl=e,o.questions[r].isMultipleChoice=n.checkcount>1,o.questions[r].additem=s}var i=t(o);jQuery("#poll_content_"+e).html(i),jQuery("#poll_"+e).css({display:"block"}),jQuery("#poll_"+e+"_result").css({display:"none"})})}function showPollMemberNext(e,l){return"undefined"==typeof window.cur_page&&(window.cur_page=1),window.cur_page++,jQuery.exec_json("poll.getPollitemInfo",{poll_srl:e,poll_item:l,page:window.cur_page},function(t){initTemplete("members");var o=window.template_member,s=Object;s.poll_srl=e,s.poll_item_srl=l,s.page=window.cur_page,s.isPage=t.page.total_count>5&&window.cur_page<t.page.total_page,s.members={};for(var r in t.item.member){var n=t.item.member[r];s.members[r]={},s.members[r].profile_image=n.profile_image,s.members[r].member_srl=n.member_srl,s.members[r].nick_name=n.nick_name,s.members[r].isImage=""!=n.profile_image,s.members[r].dummy_profile=t.dummy_profile}var i=o(s);jQuery("#btn_load_more_"+l).replaceWith(i)}),!1}function showPollMember(e,l){return window.cur_page=1,jQuery.exec_json("poll.getPollitemInfo",{poll_srl:e,poll_item:l,page:window.cur_page},function(t){initTemplete("members");var o=window.template_member,s=Object,r=poll_member_lang;r=r.replace("%s",t.item.title);var n='<div class="itemDiv"><div class="title">'+r+"</div><ul>";s.poll_srl=e,s.poll_item_srl=l,s.page=window.cur_page,s.isPage=t.page.total_count>5&&window.cur_page<t.page.total_count,s.members={};for(var i in t.item.member){var u=t.item.member[i];s.members[i]={},s.members[i].profile_image=u.profile_image,s.members[i].member_srl=u.member_srl,s.members[i].nick_name=u.nick_name,s.members[i].isImage=""!=u.profile_image,s.members[i].dummy_profile=t.dummy_profile}n=n+o(s)+"</ul></div>",jQuery("#poll_content_"+e+"_result").html(n),jQuery("#poll_"+e+"_gotoresult_button").css({display:"table-row"}),jQuery("#poll_"+e+"_result_nobutton").css({display:"none"}),jQuery("#poll_"+e+"_result_yesbutton").css({display:"table-row"})}),!1}function loadPollResult(e){jQuery.exec_json("poll.getPollinfo",{poll_srl:e},function(l){jQuery("#stop_date_result_"+e).html(l.poll.stop_date),jQuery("#poll_count_result_"+e).html(l.poll.poll_count),initTemplete("result");var t=window.template_result,o=Object,s=1==l.poll.poll_type||3==l.poll.poll_type;o.questions={};for(var r in l.poll.poll){var n=l.poll.poll[r];o.questions[r]={},o.questions[r].poll_index_srl=n.poll_index_srl,o.questions[r].checkcount=n.checkcount,o.questions[r].title=n.title,o.questions[r].poll_count=n.poll_count,o.questions[r].showMembers=s,o.questions[r].items=n.item;var i=0;for(var u in n.item){var _=n.item[u];i++,n.poll_count>0?(o.questions[r].items[u].per=Math.round(_.poll_count/n.poll_count*100),o.questions[r].items[u].isVote=!0):(o.questions[r].items[u].per=0,o.questions[r].items[u].isVote=!1),o.questions[r].items[u].number=i}o.questions[r].items=n.item,o.questions[r].poll_srl=e,o.questions[r].isMultipleChoice=n.checkcount>1}var a=t(o);jQuery("#poll_content_"+e+"_result").html(a),jQuery("#poll_"+e).css({display:"none"}),jQuery("#poll_"+e+"_result").css({display:"block"})})}jQuery(function(e){e("._poll_result").click(function(){var l,t=e(this).attr("class");try{l=t.match(/\b_srl_(\d+)\b/)[1]}catch(o){}return l?(jQuery("#poll_"+l+"_result_button").css({display:"table-row"}),jQuery("#poll_"+l+"_result_nobutton").css({display:"none"}),jQuery("#poll_"+l+"_result_yesbutton").css({display:"table-row"}),loadPollResult(l),!1):!1}),e("._gotoresult_screen").click(function(){var l,t=e(this).attr("class");try{l=t.match(/\b_srl_(\d+)\b/)[1]}catch(o){}return l?(jQuery("#poll_"+l+"_gotoresult_button").css({display:"none"}),jQuery("#poll_"+l+"_result_nobutton").css({display:"table-row"}),jQuery("#poll_"+l+"_result_yesbutton").css({display:"none"}),loadPollResult(l),!1):!1}),e("._poll_screen").click(function(){var l,t=e(this).attr("class");try{l=t.match(/\b_srl_(\d+)\b/)[1]}catch(o){}return l?(jQuery("#poll_"+l+"_result_button").css({display:"none"}),jQuery("#poll_"+l+"_result_nobutton").css({display:"table-row"}),jQuery("#poll_"+l+"_result_yesbutton").css({display:"none"}),loadPoll(l),!1):!1})});